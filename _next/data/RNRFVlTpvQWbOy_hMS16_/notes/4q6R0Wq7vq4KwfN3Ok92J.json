{"pageProps":{"note":{"id":"4q6R0Wq7vq4KwfN3Ok92J","title":"Pf","desc":"","updated":1638516076210,"created":1615882210535,"custom":{},"fname":"tools.chemoinformatics.qiime.cscs.pf","type":"note","vault":{"fsPath":"vault"},"contentHash":"aa6d7f6e250e200ce87d04871832752e","links":[],"anchors":{"qemistree-dataset":{"type":"header","text":"Qemistree dataset","value":"qemistree-dataset","line":76,"column":0,"depth":2},"update":{"type":"header","text":"Update","value":"update","line":81,"column":0,"depth":2}},"children":[],"parent":"cO1TjrEicNPknM4qFPBm1","data":{}},"body":"<h1 id=\"pf\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#pf\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Pf</h1>\n<p>Tuesday 16 March 2021</p>\n<p>Recipee for the PF MN CSCS calculations</p>\n<p>First it appears that conda is not present</p>\n<p>This <a href=\"https://askubuntu.com/a/1062621\">https://askubuntu.com/a/1062621</a> solved the problem\nexport PATH=~/anaconda3/bin:$PATH</p>\n<p>Need to reinstall the latest qiime version sudo wget <a href=\"https://data.qiime2.org/distro/core/qiime2-2021.2-py36-linux-conda.yml\">https://data.qiime2.org/distro/core/qiime2-2021.2-py36-linux-conda.yml</a></p>\n<p>source activate qiime2-2021.2</p>\n<p>wget / curl not working (proxy reason most likely on x2go)</p>\n<p>We use the peak_list_formatter_cscs.py to get GNPS job and propelry format the quantification tables</p>\n<p><code>biom convert -i for_biom.tsv -o for_biom.biom --table-type=\"OTU table\" --to-hdf5</code></p>\n<p>Then convert the .biom feature table to a .qza feature table :</p>\n<p><code>qiime tools import --type 'FeatureTable[Frequency]' --input-path for_biom.biom --output-path feature_table.qza</code></p>\n<p>To compute the chemical structural and compositional dissimilarity metric for all pairs of samples in your feature table type:</p>\n<p><code>nohup time qiime cscs cscs --p-css-edges networkedges_selfloop --i-features quantification_table --p-cosine-threshold 0.7 --p-normalization --p-cpus 40 --o-distance-matrix cscs_distance_matrix.qza</code></p>\n<p>'time qiime cscs cscs --p-css-edges networkedges_selfloop/31a1340378cd46d7b9f5ebf8afbb2565..selfloop --i-features feature_table.qza --p-cosine-threshold 0.7 --p-normalization --p-cpus 40 --o-distance-matrix cscs_distance_matrix.qza'</p>\n<p>'nohup bash -c 'time qiime cscs cscs --p-css-edges networkedges_selfloop/31a1340378cd46d7b9f5ebf8afbb2565..selfloop --i-features feature_table.qza --p-cosine-threshold 0.7 --p-normalization --p-cpus 40 --o-distance-matrix cscs_distance_matrix.qza''</p>\n<p>'nohup bash -c 'time qiime cscs cscs --p-css-edges networkedges_selfloop/31a1340378cd46d7b9f5ebf8afbb2565..selfloop --i-features feature_table.qza --p-cosine-threshold 0.7 --p-normalization --p-no-weighted --p-cpus 40 --o-distance-matrix cscs_distance_matrix_unweighed.qza''</p>\n<p>nohup bash -c 'time qiime cscs cscs --p-css-edges networkedges_selfloop/3466497461974198a9ab8c9463d05b53..selfloop --i-features feature_table.qza --p-cosine-threshold 0.7 --p-normalization --p-no-weighted --p-cpus 40 --o-distance-matrix cscs_distance_matrix_unweighed.qza'</p>\n<p>nohup bash -c 'time qiime cscs cscs --p-css-edges networkedges_selfloop/3466497461974198a9ab8c9463d05b53..selfloop --i-features feature_table.qza --p-cosine-threshold 0.7 --p-normalization --p-cpus 40 --o-distance-matrix cscs_distance_matrix.qza'</p>\n<p>Visualize the chemical structural and compositional dissimilarity in interactive PCoA space\nTo create PCos from the chemical structural and compositional dissimilarity matrix type:</p>\n<p><code>qiime diversity pcoa --i-distance-matrix cscs_distance_matrix.qza --o-pcoa cscs_PCoA.qza</code></p>\n<p>To create an interactive ordination plot of the above created PCoA with integrated sample metadata, prepare a metadata file. You can find a metadata file for this example dataset within the Example folder. Make sure that the Sample IDs provided in the metadata file correspond to the Sample IDs in your distance_matrix.qza file. Then type:</p>\n<p>Uploading previously generated metadata\nrsync -rvz -e 'ssh' --progress ./PF_metadata_qiime.tsv <a href=\"mailto:allardp@x2go.epgl-geneve.org\">allardp@x2go.epgl-geneve.org</a>:</p>\n<p><code>qiime emperor plot --i-pcoa cscs_PCoA.qza --m-metadata-file PF_metadata_qiime.tsv --o-visualization cscs_PCoA.qzv</code></p>\n<p>To visualize the interactive PCoA type:</p>\n<p><code>qiime tools view cscs_PCoA.qzv</code></p>\n<p>  --p-normalization / --p-no-normalization\nPerform Total Ion Current Normalization (TIC) on the\nfeature table                         [default: True]\n--p-weighted / --p-no-weighted\nWeight CSCS by feature intensity      [default: True]</p>\n<h2 id=\"qemistree-dataset\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#qemistree-dataset\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Qemistree dataset</h2>\n<p><a href=\"https://gnps.ucsd.edu/ProteoSAFe/status.jsp?task=044e981ff0d84246ae5c91ef3db643a8\">https://gnps.ucsd.edu/ProteoSAFe/status.jsp?task=044e981ff0d84246ae5c91ef3db643a8</a></p>\n<h2 id=\"update\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#update\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Update</h2>\n<p>Monday 29 November 2021</p>\n<p>Reiterating qiime-cscs calculations for the MEMO paper.\nInstalling qiime on the beast cluster</p>\n<p>When trying to install using the latest qiime version (qiime2-2021.11) the qiime2-cscs plugin (<a href=\"https://github.com/madeleineernst/q2-cscs\">https://github.com/madeleineernst/q2-cscs</a>) doesn't appears\nI thus switch back to qiime2-2021.2</p>\n<p>I used this script to fetch and format data from switch <a href=\"https://github.com/mandelbrot-project/qiime-empress-formatter/blob/main/src/python/peak_list_formatter_cscs_memo.py\">https://github.com/mandelbrot-project/qiime-empress-formatter/blob/main/src/python/peak_list_formatter_cscs_memo.py</a></p>\n<p>From now restarting with the recipee above (will modify or update when needed)</p>\n<p>We then convert using biom </p>\n<p>(Note that BIOM needs to be installed in an env with conda > 3.8)</p>\n<p><code>biom convert -i feature_table_for_biom.tsv -o biom_feature_table.biom --table-type=\"OTU table\" --to-hdf5</code></p>\n<p>I get a </p>\n<p>'biom.exception.TableException: Duplicate observation IDs'</p>\n<p>Apparently this error came from the fact that the feature-id were kept as index but not exported in the tsv table.\nMake sure they are.</p>\n<p>I then activate the qiime2-2021.2 env</p>\n<p><code>qiime tools import --type 'FeatureTable[Frequency]' --input-path biom_feature_table.biom --output-path feature_table.qza</code></p>\n<p>We now launch the command and explicitly specify all options</p>\n<p><code>nohup bash -c 'time qiime cscs cscs --p-css-edges networkedges_selfloop/31a1340378cd46d7b9f5ebf8afbb2565..selfloop --i-features feature_table.qza --p-cosine-threshold 0.7 --p-normalization --p-weighted --p-cpus 40 --o-distance-matrix pf_gnps3_cscs_distance_matrix_weighted.qza'</code></p>\n<p><code>nohup bash -c 'time qiime cscs cscs --p-css-edges networkedges_selfloop/31a1340378cd46d7b9f5ebf8afbb2565..selfloop --i-features feature_table.qza --p-cosine-threshold 0.7 --p-normalization --p-no-weighted --p-cpus 40 --o-distance-matrix pf_gnps3_cscs_distance_matrix_unweighted.qza'</code></p>\n<p>Here I get an error </p>\n<pre><code>Plugin error from cscs:\n\n  'function' object has no attribute 'ids'\n\nDebug info has been saved to /tmp/qiime2-q2cli-err-d8fmgz9a.log\n\nreal    0m23.731s\nuser    0m8.089s\nsys     0m3.754s\n\n</code></pre>\n<p>And this changed the file </p>\n<p>nano ./anaconda3/envs/qiime2-2021.2/lib/python3.6/site-packages/q2_cscs/q2_cscs.py</p>\n<p>by adding () to pa</p>\n<pre><code>if normalization:\n    features = features.norm(axis='sample', inplace=False)\nif weighted == False:\n    features = features.pa()\n</code></pre>\n<p>To get the tsv </p>\n<p>The resulting qza artifacts can then be renamed to .zip and extracted to fetch the corresponding distance matrix in tsv format.</p>\n<p>qiime diversity pcoa --i-distance-matrix qeemistree_set_cscs_distance_matrix_norm_weighted.qza --o-pcoa PCOA_qeemistree_set_cscs_distance_matrix_norm_weighted.qza</p>\n<p>qiime emperor plot --i-pcoa PCOA_qeemistree_set_cscs_distance_matrix_norm_weighted.qza --m-metadata-file metadata_table/metadata_table-00000.tsv --p-ignore-missing-samples --o-visualization PCOA_qeemistree_set_cscs_distance_matrix_norm_weighted_viz.qzv</p>\n<p>qiime emperor plot --i-pcoa PCOA_qeemistree_set_cscs_distance_matrix_norm_unweighted.qza --m-metadata-file metadata_table-00000.tsv --p-ignore-missing-samples --o-visualization PCOA_qeemistree_set_cscs_distance_matrix_norm_unweighted_viz.qzv</p>\n<p>qiime emperor plot --i-pcoa PCOA_qeemistree_set_cscs_distance_matrix_nonorm_weighted.qza --m-metadata-file metadata_table-00000.tsv --p-ignore-missing-samples --o-visualization PCOA_qeemistree_set_cscs_distance_matrix_nonorm_weighted_viz.qzv</p>\n<p>qiime emperor plot --i-pcoa PCOA_qeemistree_set_cscs_distance_matrix_nonorm_unweighted.qza --m-metadata-file metadata_table-00000.tsv --p-ignore-missing-samples --o-visualization PCOA_qeemistree_set_cscs_distance_matrix_nonorm_unweighted_viz.qzv</p>","noteIndex":{"id":"gvOH1py1NfW3ihejtp1nt","title":"Root","desc":"","updated":1629628449617,"created":1629628449617,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"vault"},"contentHash":"35415410233b3af68001893c83fd0c46","links":[{"type":"wiki","from":{"fname":"root","id":"gvOH1py1NfW3ihejtp1nt","vaultName":"vault"},"value":"user.oolonek","alias":"@oolonek","position":{"start":{"line":5,"column":7,"offset":225},"end":{"line":5,"column":15,"offset":233},"indent":[]},"xvault":false,"to":{"fname":"user.oolonek"}}],"anchors":{"welcome-to-dendron":{"type":"header","text":"Welcome to Dendron","value":"welcome-to-dendron","line":7,"column":0,"depth":1}},"children":["kPtYPP8JzWBTzWz6JpnkS","3LmAI71UuDJHeWZiY9h96","TyTThFOL2RNC8FAIj5bZN","e4C8xkTTKKue3fz5ywgBH","u88hb42Nk8jvzQwtMfM3z","rInb8zzM4kEHelz4CeWDa","hUOQrqfgNFdSu7GD8fP2c","J9JmfJgjDT8Oz6WilFnKw","Iu50F9KOgYp0CDpwKBlx6","xZShWyRUMIXQaN30pKmCM","f1fsD9inrKMVapeKNhEhT","VhvHTRFNvIEee7odQvekB","D2j8S1AufMK6GbZTZ9BJz","HMvEFZAnQOxD77TnbVwGV","NYpAWkhSLKKkHIbDIbshA","0MSZusMXhweDvHD3Iggww","q5kFqQrTnytdWSux3nwOk","1PGMuBcw56lKG0Xu5sxIX","f4P2xBJLTHpQpJYiJh7BV","7KJGsaBJWOOHaHqElRaJq","BunyVngKi3As0C0CO5xhy","iRR8MxJPGIvfKl5pcOirA","3qcjidzC0tkyobYKlrWYc","uviazqrM9NUAMm9dWYVa7","7WpN3kiuBsunRJ17P3mGr","9j2pl0fgjc9tperwhyk7z9m","53WWGL5wGfRDGtBEJoqBd","EoQW6Rm5LYkkCxMgDVXHd","k7IyxWpd9nYqWlhZ96CAG","maJAMIUSNCqgSTXrQ7fu5","rrfMr3vOgkyJv21N8x99X"],"parent":null,"data":{},"body":"# Welcome to Dendron\n\nThis is the root of your dendron vault. If you decide to publish your entire vault, this will be your landing page. You are free to customize any part of this page except the frontmatter on top. \n\nKudos @oolonek, you did great job! \nWhen using https://oolonek.github.io/dendron-ws-private/, here is what I got:\n\n<img width=\"1676\" alt=\"Capture d’écran 2021-08-22 à 13 19 54\" src=\"https://user-images.githubusercontent.com/44283913/130353241-43ba98eb-d947-473c-be08-d924f0ef585b.png\">\n\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":4,"useFMTitle":true,"useNoteTitleForLink":true,"mermaid":true,"useKatex":true,"dev":{"enablePreviewV2":true},"site":{"copyAssets":true,"siteHierarchies":["root"],"siteRootDir":"docs","siteUrl":"https://oolonek.github.io","gh_edit_link":true,"gh_edit_link_text":"Click here to edit this page on Github !","gh_edit_repository":"https://github.com/oolonek/dendron-ws-public","gh_edit_branch":"main","gh_edit_view_mode":"edit","assetsPrefix":"/dendron-ws-public","usePrettyRefs":true,"siteLastModified":true,"title":"GrndStt's Dendron","description":"Personal knowledge space","duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"usePrettyLinks":true,"siteNotesDir":"notes","siteFaviconPath":"favicon.ico","gh_root":"docs/","writeStubs":true,"siteIndex":"root"},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":false,"leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2,"vaultSelectionModeOnCreate":"smart"}},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"randomNote":{},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"dendronVersion":"0.77.1","vaults":[{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":true,"maxPreviewsCached":10,"maxNoteLength":204800,"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"enableUserTags":true,"enableHashTags":true,"enableEditorDecorations":true,"enableFullHierarchyNoteTitle":false,"enableSmartRefs":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Dendron","description":"Personal Knowledge Space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true}}},"__N_SSG":true}