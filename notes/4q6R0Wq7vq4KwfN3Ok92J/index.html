<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><title>Pf</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal knowledge space"/><meta property="og:title" content="Pf"/><meta property="og:description" content="Personal knowledge space"/><meta property="og:url" content="https://oolonek.github.io/dendron-ws-public/notes/4q6R0Wq7vq4KwfN3Ok92J/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="3/16/2021"/><meta property="article:modified_time" content="12/3/2021"/><link rel="canonical" href="https://oolonek.github.io/dendron-ws-public/notes/4q6R0Wq7vq4KwfN3Ok92J/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/dendron-ws-public/_next/static/css/d71ae863ca0982aa.css" as="style"/><link rel="stylesheet" href="/dendron-ws-public/_next/static/css/d71ae863ca0982aa.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/dendron-ws-public/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/dendron-ws-public/_next/static/chunks/webpack-edee4a902ba6cd68.js" defer=""></script><script src="/dendron-ws-public/_next/static/chunks/framework-bb5c596eafb42b22.js" defer=""></script><script src="/dendron-ws-public/_next/static/chunks/main-5d2cf6b7c510562f.js" defer=""></script><script src="/dendron-ws-public/_next/static/chunks/pages/_app-3104d4a48209fdcf.js" defer=""></script><script src="/dendron-ws-public/_next/static/chunks/855-124c7d93158bd007.js" defer=""></script><script src="/dendron-ws-public/_next/static/chunks/776-959ab9b5289532fd.js" defer=""></script><script src="/dendron-ws-public/_next/static/chunks/pages/notes/%5Bid%5D-9c4f89da4e36492e.js" defer=""></script><script src="/dendron-ws-public/_next/static/RNRFVlTpvQWbOy_hMS16_/_buildManifest.js" defer=""></script><script src="/dendron-ws-public/_next/static/RNRFVlTpvQWbOy_hMS16_/_ssgManifest.js" defer=""></script><script src="/dendron-ws-public/_next/static/RNRFVlTpvQWbOy_hMS16_/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout" style="margin-top:64px;display:flex;flex-direction:row"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><main class="ant-layout-content side-layout-main" style="max-width:1200px;min-width:0;display:block"><div class="main-content" role="main" style="padding:0 24px"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="pf"><a aria-hidden="true" class="anchor-heading" href="#pf"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Pf</h1>
<p>Tuesday 16 March 2021</p>
<p>Recipee for the PF MN CSCS calculations</p>
<p>First it appears that conda is not present</p>
<p>This <a href="https://askubuntu.com/a/1062621">https://askubuntu.com/a/1062621</a> solved the problem
export PATH=~/anaconda3/bin:$PATH</p>
<p>Need to reinstall the latest qiime version sudo wget <a href="https://data.qiime2.org/distro/core/qiime2-2021.2-py36-linux-conda.yml">https://data.qiime2.org/distro/core/qiime2-2021.2-py36-linux-conda.yml</a></p>
<p>source activate qiime2-2021.2</p>
<p>wget / curl not working (proxy reason most likely on x2go)</p>
<p>We use the peak_list_formatter_cscs.py to get GNPS job and propelry format the quantification tables</p>
<p><code>biom convert -i for_biom.tsv -o for_biom.biom --table-type="OTU table" --to-hdf5</code></p>
<p>Then convert the .biom feature table to a .qza feature table :</p>
<p><code>qiime tools import --type 'FeatureTable[Frequency]' --input-path for_biom.biom --output-path feature_table.qza</code></p>
<p>To compute the chemical structural and compositional dissimilarity metric for all pairs of samples in your feature table type:</p>
<p><code>nohup time qiime cscs cscs --p-css-edges networkedges_selfloop --i-features quantification_table --p-cosine-threshold 0.7 --p-normalization --p-cpus 40 --o-distance-matrix cscs_distance_matrix.qza</code></p>
<p>'time qiime cscs cscs --p-css-edges networkedges_selfloop/31a1340378cd46d7b9f5ebf8afbb2565..selfloop --i-features feature_table.qza --p-cosine-threshold 0.7 --p-normalization --p-cpus 40 --o-distance-matrix cscs_distance_matrix.qza'</p>
<p>'nohup bash -c 'time qiime cscs cscs --p-css-edges networkedges_selfloop/31a1340378cd46d7b9f5ebf8afbb2565..selfloop --i-features feature_table.qza --p-cosine-threshold 0.7 --p-normalization --p-cpus 40 --o-distance-matrix cscs_distance_matrix.qza''</p>
<p>'nohup bash -c 'time qiime cscs cscs --p-css-edges networkedges_selfloop/31a1340378cd46d7b9f5ebf8afbb2565..selfloop --i-features feature_table.qza --p-cosine-threshold 0.7 --p-normalization --p-no-weighted --p-cpus 40 --o-distance-matrix cscs_distance_matrix_unweighed.qza''</p>
<p>nohup bash -c 'time qiime cscs cscs --p-css-edges networkedges_selfloop/3466497461974198a9ab8c9463d05b53..selfloop --i-features feature_table.qza --p-cosine-threshold 0.7 --p-normalization --p-no-weighted --p-cpus 40 --o-distance-matrix cscs_distance_matrix_unweighed.qza'</p>
<p>nohup bash -c 'time qiime cscs cscs --p-css-edges networkedges_selfloop/3466497461974198a9ab8c9463d05b53..selfloop --i-features feature_table.qza --p-cosine-threshold 0.7 --p-normalization --p-cpus 40 --o-distance-matrix cscs_distance_matrix.qza'</p>
<p>Visualize the chemical structural and compositional dissimilarity in interactive PCoA space
To create PCos from the chemical structural and compositional dissimilarity matrix type:</p>
<p><code>qiime diversity pcoa --i-distance-matrix cscs_distance_matrix.qza --o-pcoa cscs_PCoA.qza</code></p>
<p>To create an interactive ordination plot of the above created PCoA with integrated sample metadata, prepare a metadata file. You can find a metadata file for this example dataset within the Example folder. Make sure that the Sample IDs provided in the metadata file correspond to the Sample IDs in your distance_matrix.qza file. Then type:</p>
<p>Uploading previously generated metadata
rsync -rvz -e 'ssh' --progress ./PF_metadata_qiime.tsv <a href="mailto:allardp@x2go.epgl-geneve.org">allardp@x2go.epgl-geneve.org</a>:</p>
<p><code>qiime emperor plot --i-pcoa cscs_PCoA.qza --m-metadata-file PF_metadata_qiime.tsv --o-visualization cscs_PCoA.qzv</code></p>
<p>To visualize the interactive PCoA type:</p>
<p><code>qiime tools view cscs_PCoA.qzv</code></p>
<p>  --p-normalization / --p-no-normalization
Perform Total Ion Current Normalization (TIC) on the
feature table                         [default: True]
--p-weighted / --p-no-weighted
Weight CSCS by feature intensity      [default: True]</p>
<h2 id="qemistree-dataset"><a aria-hidden="true" class="anchor-heading" href="#qemistree-dataset"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Qemistree dataset</h2>
<p><a href="https://gnps.ucsd.edu/ProteoSAFe/status.jsp?task=044e981ff0d84246ae5c91ef3db643a8">https://gnps.ucsd.edu/ProteoSAFe/status.jsp?task=044e981ff0d84246ae5c91ef3db643a8</a></p>
<h2 id="update"><a aria-hidden="true" class="anchor-heading" href="#update"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Update</h2>
<p>Monday 29 November 2021</p>
<p>Reiterating qiime-cscs calculations for the MEMO paper.
Installing qiime on the beast cluster</p>
<p>When trying to install using the latest qiime version (qiime2-2021.11) the qiime2-cscs plugin (<a href="https://github.com/madeleineernst/q2-cscs">https://github.com/madeleineernst/q2-cscs</a>) doesn't appears
I thus switch back to qiime2-2021.2</p>
<p>I used this script to fetch and format data from switch <a href="https://github.com/mandelbrot-project/qiime-empress-formatter/blob/main/src/python/peak_list_formatter_cscs_memo.py">https://github.com/mandelbrot-project/qiime-empress-formatter/blob/main/src/python/peak_list_formatter_cscs_memo.py</a></p>
<p>From now restarting with the recipee above (will modify or update when needed)</p>
<p>We then convert using biom </p>
<p>(Note that BIOM needs to be installed in an env with conda > 3.8)</p>
<p><code>biom convert -i feature_table_for_biom.tsv -o biom_feature_table.biom --table-type="OTU table" --to-hdf5</code></p>
<p>I get a </p>
<p>'biom.exception.TableException: Duplicate observation IDs'</p>
<p>Apparently this error came from the fact that the feature-id were kept as index but not exported in the tsv table.
Make sure they are.</p>
<p>I then activate the qiime2-2021.2 env</p>
<p><code>qiime tools import --type 'FeatureTable[Frequency]' --input-path biom_feature_table.biom --output-path feature_table.qza</code></p>
<p>We now launch the command and explicitly specify all options</p>
<p><code>nohup bash -c 'time qiime cscs cscs --p-css-edges networkedges_selfloop/31a1340378cd46d7b9f5ebf8afbb2565..selfloop --i-features feature_table.qza --p-cosine-threshold 0.7 --p-normalization --p-weighted --p-cpus 40 --o-distance-matrix pf_gnps3_cscs_distance_matrix_weighted.qza'</code></p>
<p><code>nohup bash -c 'time qiime cscs cscs --p-css-edges networkedges_selfloop/31a1340378cd46d7b9f5ebf8afbb2565..selfloop --i-features feature_table.qza --p-cosine-threshold 0.7 --p-normalization --p-no-weighted --p-cpus 40 --o-distance-matrix pf_gnps3_cscs_distance_matrix_unweighted.qza'</code></p>
<p>Here I get an error </p>
<pre><code>Plugin error from cscs:

  'function' object has no attribute 'ids'

Debug info has been saved to /tmp/qiime2-q2cli-err-d8fmgz9a.log

real    0m23.731s
user    0m8.089s
sys     0m3.754s

</code></pre>
<p>And this changed the file </p>
<p>nano ./anaconda3/envs/qiime2-2021.2/lib/python3.6/site-packages/q2_cscs/q2_cscs.py</p>
<p>by adding () to pa</p>
<pre><code>if normalization:
    features = features.norm(axis='sample', inplace=False)
if weighted == False:
    features = features.pa()
</code></pre>
<p>To get the tsv </p>
<p>The resulting qza artifacts can then be renamed to .zip and extracted to fetch the corresponding distance matrix in tsv format.</p>
<p>qiime diversity pcoa --i-distance-matrix qeemistree_set_cscs_distance_matrix_norm_weighted.qza --o-pcoa PCOA_qeemistree_set_cscs_distance_matrix_norm_weighted.qza</p>
<p>qiime emperor plot --i-pcoa PCOA_qeemistree_set_cscs_distance_matrix_norm_weighted.qza --m-metadata-file metadata_table/metadata_table-00000.tsv --p-ignore-missing-samples --o-visualization PCOA_qeemistree_set_cscs_distance_matrix_norm_weighted_viz.qzv</p>
<p>qiime emperor plot --i-pcoa PCOA_qeemistree_set_cscs_distance_matrix_norm_unweighted.qza --m-metadata-file metadata_table-00000.tsv --p-ignore-missing-samples --o-visualization PCOA_qeemistree_set_cscs_distance_matrix_norm_unweighted_viz.qzv</p>
<p>qiime emperor plot --i-pcoa PCOA_qeemistree_set_cscs_distance_matrix_nonorm_weighted.qza --m-metadata-file metadata_table-00000.tsv --p-ignore-missing-samples --o-visualization PCOA_qeemistree_set_cscs_distance_matrix_nonorm_weighted_viz.qzv</p>
<p>qiime emperor plot --i-pcoa PCOA_qeemistree_set_cscs_distance_matrix_nonorm_unweighted.qza --m-metadata-file metadata_table-00000.tsv --p-ignore-missing-samples --o-visualization PCOA_qeemistree_set_cscs_distance_matrix_nonorm_unweighted_viz.qzv</p></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#qemistree-dataset" title="Qemistree dataset">Qemistree dataset</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#update" title="Update">Update</a></div></div></div></div></div></div></div></div></div></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></main></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"4q6R0Wq7vq4KwfN3Ok92J","title":"Pf","desc":"","updated":1638516076210,"created":1615882210535,"custom":{},"fname":"tools.chemoinformatics.qiime.cscs.pf","type":"note","vault":{"fsPath":"vault"},"contentHash":"aa6d7f6e250e200ce87d04871832752e","links":[],"anchors":{"qemistree-dataset":{"type":"header","text":"Qemistree dataset","value":"qemistree-dataset","line":76,"column":0,"depth":2},"update":{"type":"header","text":"Update","value":"update","line":81,"column":0,"depth":2}},"children":[],"parent":"cO1TjrEicNPknM4qFPBm1","data":{}},"body":"\u003ch1 id=\"pf\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#pf\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003ePf\u003c/h1\u003e\n\u003cp\u003eTuesday 16 March 2021\u003c/p\u003e\n\u003cp\u003eRecipee for the PF MN CSCS calculations\u003c/p\u003e\n\u003cp\u003eFirst it appears that conda is not present\u003c/p\u003e\n\u003cp\u003eThis \u003ca href=\"https://askubuntu.com/a/1062621\"\u003ehttps://askubuntu.com/a/1062621\u003c/a\u003e solved the problem\nexport PATH=~/anaconda3/bin:$PATH\u003c/p\u003e\n\u003cp\u003eNeed to reinstall the latest qiime version sudo wget \u003ca href=\"https://data.qiime2.org/distro/core/qiime2-2021.2-py36-linux-conda.yml\"\u003ehttps://data.qiime2.org/distro/core/qiime2-2021.2-py36-linux-conda.yml\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003esource activate qiime2-2021.2\u003c/p\u003e\n\u003cp\u003ewget / curl not working (proxy reason most likely on x2go)\u003c/p\u003e\n\u003cp\u003eWe use the peak_list_formatter_cscs.py to get GNPS job and propelry format the quantification tables\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ebiom convert -i for_biom.tsv -o for_biom.biom --table-type=\"OTU table\" --to-hdf5\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eThen convert the .biom feature table to a .qza feature table :\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eqiime tools import --type 'FeatureTable[Frequency]' --input-path for_biom.biom --output-path feature_table.qza\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eTo compute the chemical structural and compositional dissimilarity metric for all pairs of samples in your feature table type:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003enohup time qiime cscs cscs --p-css-edges networkedges_selfloop --i-features quantification_table --p-cosine-threshold 0.7 --p-normalization --p-cpus 40 --o-distance-matrix cscs_distance_matrix.qza\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e'time qiime cscs cscs --p-css-edges networkedges_selfloop/31a1340378cd46d7b9f5ebf8afbb2565..selfloop --i-features feature_table.qza --p-cosine-threshold 0.7 --p-normalization --p-cpus 40 --o-distance-matrix cscs_distance_matrix.qza'\u003c/p\u003e\n\u003cp\u003e'nohup bash -c 'time qiime cscs cscs --p-css-edges networkedges_selfloop/31a1340378cd46d7b9f5ebf8afbb2565..selfloop --i-features feature_table.qza --p-cosine-threshold 0.7 --p-normalization --p-cpus 40 --o-distance-matrix cscs_distance_matrix.qza''\u003c/p\u003e\n\u003cp\u003e'nohup bash -c 'time qiime cscs cscs --p-css-edges networkedges_selfloop/31a1340378cd46d7b9f5ebf8afbb2565..selfloop --i-features feature_table.qza --p-cosine-threshold 0.7 --p-normalization --p-no-weighted --p-cpus 40 --o-distance-matrix cscs_distance_matrix_unweighed.qza''\u003c/p\u003e\n\u003cp\u003enohup bash -c 'time qiime cscs cscs --p-css-edges networkedges_selfloop/3466497461974198a9ab8c9463d05b53..selfloop --i-features feature_table.qza --p-cosine-threshold 0.7 --p-normalization --p-no-weighted --p-cpus 40 --o-distance-matrix cscs_distance_matrix_unweighed.qza'\u003c/p\u003e\n\u003cp\u003enohup bash -c 'time qiime cscs cscs --p-css-edges networkedges_selfloop/3466497461974198a9ab8c9463d05b53..selfloop --i-features feature_table.qza --p-cosine-threshold 0.7 --p-normalization --p-cpus 40 --o-distance-matrix cscs_distance_matrix.qza'\u003c/p\u003e\n\u003cp\u003eVisualize the chemical structural and compositional dissimilarity in interactive PCoA space\nTo create PCos from the chemical structural and compositional dissimilarity matrix type:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eqiime diversity pcoa --i-distance-matrix cscs_distance_matrix.qza --o-pcoa cscs_PCoA.qza\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eTo create an interactive ordination plot of the above created PCoA with integrated sample metadata, prepare a metadata file. You can find a metadata file for this example dataset within the Example folder. Make sure that the Sample IDs provided in the metadata file correspond to the Sample IDs in your distance_matrix.qza file. Then type:\u003c/p\u003e\n\u003cp\u003eUploading previously generated metadata\nrsync -rvz -e 'ssh' --progress ./PF_metadata_qiime.tsv \u003ca href=\"mailto:allardp@x2go.epgl-geneve.org\"\u003eallardp@x2go.epgl-geneve.org\u003c/a\u003e:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eqiime emperor plot --i-pcoa cscs_PCoA.qza --m-metadata-file PF_metadata_qiime.tsv --o-visualization cscs_PCoA.qzv\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eTo visualize the interactive PCoA type:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eqiime tools view cscs_PCoA.qzv\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e  --p-normalization / --p-no-normalization\nPerform Total Ion Current Normalization (TIC) on the\nfeature table                         [default: True]\n--p-weighted / --p-no-weighted\nWeight CSCS by feature intensity      [default: True]\u003c/p\u003e\n\u003ch2 id=\"qemistree-dataset\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#qemistree-dataset\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eQemistree dataset\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://gnps.ucsd.edu/ProteoSAFe/status.jsp?task=044e981ff0d84246ae5c91ef3db643a8\"\u003ehttps://gnps.ucsd.edu/ProteoSAFe/status.jsp?task=044e981ff0d84246ae5c91ef3db643a8\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"update\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#update\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eUpdate\u003c/h2\u003e\n\u003cp\u003eMonday 29 November 2021\u003c/p\u003e\n\u003cp\u003eReiterating qiime-cscs calculations for the MEMO paper.\nInstalling qiime on the beast cluster\u003c/p\u003e\n\u003cp\u003eWhen trying to install using the latest qiime version (qiime2-2021.11) the qiime2-cscs plugin (\u003ca href=\"https://github.com/madeleineernst/q2-cscs\"\u003ehttps://github.com/madeleineernst/q2-cscs\u003c/a\u003e) doesn't appears\nI thus switch back to qiime2-2021.2\u003c/p\u003e\n\u003cp\u003eI used this script to fetch and format data from switch \u003ca href=\"https://github.com/mandelbrot-project/qiime-empress-formatter/blob/main/src/python/peak_list_formatter_cscs_memo.py\"\u003ehttps://github.com/mandelbrot-project/qiime-empress-formatter/blob/main/src/python/peak_list_formatter_cscs_memo.py\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eFrom now restarting with the recipee above (will modify or update when needed)\u003c/p\u003e\n\u003cp\u003eWe then convert using biom \u003c/p\u003e\n\u003cp\u003e(Note that BIOM needs to be installed in an env with conda \u003e 3.8)\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ebiom convert -i feature_table_for_biom.tsv -o biom_feature_table.biom --table-type=\"OTU table\" --to-hdf5\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eI get a \u003c/p\u003e\n\u003cp\u003e'biom.exception.TableException: Duplicate observation IDs'\u003c/p\u003e\n\u003cp\u003eApparently this error came from the fact that the feature-id were kept as index but not exported in the tsv table.\nMake sure they are.\u003c/p\u003e\n\u003cp\u003eI then activate the qiime2-2021.2 env\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eqiime tools import --type 'FeatureTable[Frequency]' --input-path biom_feature_table.biom --output-path feature_table.qza\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eWe now launch the command and explicitly specify all options\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003enohup bash -c 'time qiime cscs cscs --p-css-edges networkedges_selfloop/31a1340378cd46d7b9f5ebf8afbb2565..selfloop --i-features feature_table.qza --p-cosine-threshold 0.7 --p-normalization --p-weighted --p-cpus 40 --o-distance-matrix pf_gnps3_cscs_distance_matrix_weighted.qza'\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003enohup bash -c 'time qiime cscs cscs --p-css-edges networkedges_selfloop/31a1340378cd46d7b9f5ebf8afbb2565..selfloop --i-features feature_table.qza --p-cosine-threshold 0.7 --p-normalization --p-no-weighted --p-cpus 40 --o-distance-matrix pf_gnps3_cscs_distance_matrix_unweighted.qza'\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eHere I get an error \u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ePlugin error from cscs:\n\n  'function' object has no attribute 'ids'\n\nDebug info has been saved to /tmp/qiime2-q2cli-err-d8fmgz9a.log\n\nreal    0m23.731s\nuser    0m8.089s\nsys     0m3.754s\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd this changed the file \u003c/p\u003e\n\u003cp\u003enano ./anaconda3/envs/qiime2-2021.2/lib/python3.6/site-packages/q2_cscs/q2_cscs.py\u003c/p\u003e\n\u003cp\u003eby adding () to pa\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eif normalization:\n    features = features.norm(axis='sample', inplace=False)\nif weighted == False:\n    features = features.pa()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTo get the tsv \u003c/p\u003e\n\u003cp\u003eThe resulting qza artifacts can then be renamed to .zip and extracted to fetch the corresponding distance matrix in tsv format.\u003c/p\u003e\n\u003cp\u003eqiime diversity pcoa --i-distance-matrix qeemistree_set_cscs_distance_matrix_norm_weighted.qza --o-pcoa PCOA_qeemistree_set_cscs_distance_matrix_norm_weighted.qza\u003c/p\u003e\n\u003cp\u003eqiime emperor plot --i-pcoa PCOA_qeemistree_set_cscs_distance_matrix_norm_weighted.qza --m-metadata-file metadata_table/metadata_table-00000.tsv --p-ignore-missing-samples --o-visualization PCOA_qeemistree_set_cscs_distance_matrix_norm_weighted_viz.qzv\u003c/p\u003e\n\u003cp\u003eqiime emperor plot --i-pcoa PCOA_qeemistree_set_cscs_distance_matrix_norm_unweighted.qza --m-metadata-file metadata_table-00000.tsv --p-ignore-missing-samples --o-visualization PCOA_qeemistree_set_cscs_distance_matrix_norm_unweighted_viz.qzv\u003c/p\u003e\n\u003cp\u003eqiime emperor plot --i-pcoa PCOA_qeemistree_set_cscs_distance_matrix_nonorm_weighted.qza --m-metadata-file metadata_table-00000.tsv --p-ignore-missing-samples --o-visualization PCOA_qeemistree_set_cscs_distance_matrix_nonorm_weighted_viz.qzv\u003c/p\u003e\n\u003cp\u003eqiime emperor plot --i-pcoa PCOA_qeemistree_set_cscs_distance_matrix_nonorm_unweighted.qza --m-metadata-file metadata_table-00000.tsv --p-ignore-missing-samples --o-visualization PCOA_qeemistree_set_cscs_distance_matrix_nonorm_unweighted_viz.qzv\u003c/p\u003e","noteIndex":{"id":"gvOH1py1NfW3ihejtp1nt","title":"Root","desc":"","updated":1629628449617,"created":1629628449617,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"vault"},"contentHash":"35415410233b3af68001893c83fd0c46","links":[{"type":"wiki","from":{"fname":"root","id":"gvOH1py1NfW3ihejtp1nt","vaultName":"vault"},"value":"user.oolonek","alias":"@oolonek","position":{"start":{"line":5,"column":7,"offset":225},"end":{"line":5,"column":15,"offset":233},"indent":[]},"xvault":false,"to":{"fname":"user.oolonek"}}],"anchors":{"welcome-to-dendron":{"type":"header","text":"Welcome to Dendron","value":"welcome-to-dendron","line":7,"column":0,"depth":1}},"children":["kPtYPP8JzWBTzWz6JpnkS","3LmAI71UuDJHeWZiY9h96","TyTThFOL2RNC8FAIj5bZN","e4C8xkTTKKue3fz5ywgBH","u88hb42Nk8jvzQwtMfM3z","rInb8zzM4kEHelz4CeWDa","hUOQrqfgNFdSu7GD8fP2c","J9JmfJgjDT8Oz6WilFnKw","Iu50F9KOgYp0CDpwKBlx6","xZShWyRUMIXQaN30pKmCM","f1fsD9inrKMVapeKNhEhT","VhvHTRFNvIEee7odQvekB","D2j8S1AufMK6GbZTZ9BJz","HMvEFZAnQOxD77TnbVwGV","NYpAWkhSLKKkHIbDIbshA","0MSZusMXhweDvHD3Iggww","q5kFqQrTnytdWSux3nwOk","1PGMuBcw56lKG0Xu5sxIX","f4P2xBJLTHpQpJYiJh7BV","7KJGsaBJWOOHaHqElRaJq","BunyVngKi3As0C0CO5xhy","iRR8MxJPGIvfKl5pcOirA","3qcjidzC0tkyobYKlrWYc","uviazqrM9NUAMm9dWYVa7","7WpN3kiuBsunRJ17P3mGr","9j2pl0fgjc9tperwhyk7z9m","53WWGL5wGfRDGtBEJoqBd","EoQW6Rm5LYkkCxMgDVXHd","k7IyxWpd9nYqWlhZ96CAG","maJAMIUSNCqgSTXrQ7fu5","rrfMr3vOgkyJv21N8x99X"],"parent":null,"data":{},"body":"# Welcome to Dendron\n\nThis is the root of your dendron vault. If you decide to publish your entire vault, this will be your landing page. You are free to customize any part of this page except the frontmatter on top. \n\nKudos @oolonek, you did great job! \nWhen using https://oolonek.github.io/dendron-ws-private/, here is what I got:\n\n\u003cimg width=\"1676\" alt=\"Capture d’écran 2021-08-22 à 13 19 54\" src=\"https://user-images.githubusercontent.com/44283913/130353241-43ba98eb-d947-473c-be08-d924f0ef585b.png\"\u003e\n\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":4,"useFMTitle":true,"useNoteTitleForLink":true,"mermaid":true,"useKatex":true,"dev":{"enablePreviewV2":true},"site":{"copyAssets":true,"siteHierarchies":["root"],"siteRootDir":"docs","siteUrl":"https://oolonek.github.io","gh_edit_link":true,"gh_edit_link_text":"Click here to edit this page on Github !","gh_edit_repository":"https://github.com/oolonek/dendron-ws-public","gh_edit_branch":"main","gh_edit_view_mode":"edit","assetsPrefix":"/dendron-ws-public","usePrettyRefs":true,"siteLastModified":true,"title":"GrndStt's Dendron","description":"Personal knowledge space","duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"usePrettyLinks":true,"siteNotesDir":"notes","siteFaviconPath":"favicon.ico","gh_root":"docs/","writeStubs":true,"siteIndex":"root"},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":false,"leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2,"vaultSelectionModeOnCreate":"smart"}},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"randomNote":{},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"dendronVersion":"0.77.1","vaults":[{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":true,"maxPreviewsCached":10,"maxNoteLength":204800,"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"enableUserTags":true,"enableHashTags":true,"enableEditorDecorations":true,"enableFullHierarchyNoteTitle":false,"enableSmartRefs":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Dendron","description":"Personal Knowledge Space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"4q6R0Wq7vq4KwfN3Ok92J"},"buildId":"RNRFVlTpvQWbOy_hMS16_","assetPrefix":"/dendron-ws-public","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>