<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><title>Beast</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal knowledge space"/><meta property="og:title" content="Beast"/><meta property="og:description" content="Personal knowledge space"/><meta property="og:url" content="https://oolonek.github.io/dendron-ws-public/notes/Mlb5F1TDswu1OkB4yKCXI/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="10/23/2021"/><meta property="article:modified_time" content="2/28/2022"/><link rel="canonical" href="https://oolonek.github.io/dendron-ws-public/notes/Mlb5F1TDswu1OkB4yKCXI/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/dendron-ws-public/_next/static/css/d71ae863ca0982aa.css" as="style"/><link rel="stylesheet" href="/dendron-ws-public/_next/static/css/d71ae863ca0982aa.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/dendron-ws-public/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/dendron-ws-public/_next/static/chunks/webpack-edee4a902ba6cd68.js" defer=""></script><script src="/dendron-ws-public/_next/static/chunks/framework-bb5c596eafb42b22.js" defer=""></script><script src="/dendron-ws-public/_next/static/chunks/main-5d2cf6b7c510562f.js" defer=""></script><script src="/dendron-ws-public/_next/static/chunks/pages/_app-3104d4a48209fdcf.js" defer=""></script><script src="/dendron-ws-public/_next/static/chunks/855-124c7d93158bd007.js" defer=""></script><script src="/dendron-ws-public/_next/static/chunks/776-959ab9b5289532fd.js" defer=""></script><script src="/dendron-ws-public/_next/static/chunks/pages/notes/%5Bid%5D-9c4f89da4e36492e.js" defer=""></script><script src="/dendron-ws-public/_next/static/RNRFVlTpvQWbOy_hMS16_/_buildManifest.js" defer=""></script><script src="/dendron-ws-public/_next/static/RNRFVlTpvQWbOy_hMS16_/_ssgManifest.js" defer=""></script><script src="/dendron-ws-public/_next/static/RNRFVlTpvQWbOy_hMS16_/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout" style="margin-top:64px;display:flex;flex-direction:row"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><main class="ant-layout-content side-layout-main" style="max-width:1200px;min-width:0;display:block"><div class="main-content" role="main" style="padding:0 24px"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="beast"><a aria-hidden="true" class="anchor-heading" href="#beast"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Beast</h1>
<h1 id="variant-of-the-is-fragmentation-recipee-on-the-beast"><a aria-hidden="true" class="anchor-heading" href="#variant-of-the-is-fragmentation-recipee-on-the-beast"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Variant of the is fragmentation recipee on the beast</h1>
<p></p><p></p><div class="portal-container">
<div class="portal-head">
<div class="portal-backlink">
<div class="portal-title">From <span class="portal-text-title">Isfrag</span></div>
<a href="/dendron-ws-public/notes/6qK8k4MF0vooncgMJZw5W" class="portal-arrow">Go to text <span class="right-arrow">→</span></a>
</div>
</div>
<div id="portal-parent-anchor" class="portal-parent" markdown="1">
<div class="portal-parent-fader-top"></div>
<div class="portal-parent-fader-bottom"></div><p>Pasting an old recipee from ZettelKasten</p>
<p>Linked to <a title="Private" style="color: brown" href="https://wiki.dendron.so/notes/hfyvYGJZQiUwQaaxQO27q.html" target="_blank">202002251433 (Private)</a> in silico fragmentation worflow.</p>
<p>Children workflow on the beast MAPP </p>
<p>Side notes : try to write everything as scripts so that they can be launched without a GUI (ex on X2Go or directly Boabab).</p>
<h1 id="tutorial-for-npatlas-in-silico-fragmentation-data-treatment"><a aria-hidden="true" class="anchor-heading" href="#tutorial-for-npatlas-in-silico-fragmentation-data-treatment"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Tutorial for NPatlas in silico fragmentation data treatment</h1>
<h2 id="prior-to-fragmentation"><a aria-hidden="true" class="anchor-heading" href="#prior-to-fragmentation"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Prior to fragmentation</h2>
<h3 id="prepare-space-delimited-input-file"><a aria-hidden="true" class="anchor-heading" href="#prepare-space-delimited-input-file"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Prepare space delimited input file</h3>
<p>Complete metadate file is converted to list of Unique ID and smiles space separated (for cfm id input)</p>
<p>python frag_list_preparator.py ../npatlas_data/np_atlas_2019_12.tsv ../npatlas_data/np_atlas_2019_12_for_frag.tsv NPAID SMILES</p>
<p>python frag_list_preparator.py ../open_np_db_data/open_NP_db.tsv ../open_np_db_data/open_NP_db_tofrag.txt shortinchikey shortinchikey smiles</p>
<h3 id="split-the-file"><a aria-hidden="true" class="anchor-heading" href="#split-the-file"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Split the file</h3>
<p>(Works on Linux based shells)</p>
<p>split -a 5 -l 500 -d ../open<em>np_db_data/open_NP_db_tofrag.txt ../open_np_db_data/opennpdb_tofrag/opennpdb</em>
split -a 5 -l 500 -d ./lotus<em>data/lotus_data_for_frag.txt ./lotus_data/lotus_data_for_frag/lotus_data</em></p>
<p>split -a 5 -l 500 -d ./ ./lotus<em>data/lotus_data_for_frag/lotus_data</em>
split -a 5 -l 500 -d cfm/cfm<em>input/platinum_tofrag.tsv cfm/cfm_input/splitted/lotus_to_frag</em></p>
<p>This one allows to preserve extensions and is build on number of desired chunks without splitting lines
split -a 5 -n l/199 -d --additional-suffix=.txt  cfm<em>input/sub_platinum_tofrag.tsv cfm_input/splitted/lotus_to_frag</em></p>
<h3 id="when-using-the-docker-cli-files-need-to-have-an-extension-or-taken-as-folder-"><a aria-hidden="true" class="anchor-heading" href="#when-using-the-docker-cli-files-need-to-have-an-extension-or-taken-as-folder-"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>When using the docker cli files need to have an extension (or taken as folder ?)</h3>
<p>for f in *; do mv "<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mi mathvariant="normal">"</mi><mi mathvariant="normal">"</mi></mrow><annotation encoding="application/x-tex">f" "</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord">""</span></span></span></span></span>f.txt"; done</p>
<p>if you made a mistacke </p>
<p>find / -type f -name '*.txt' -exec sh -c 'mv -- "<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mi mathvariant="normal">"</mi><mi mathvariant="normal">"</mi></mrow><annotation encoding="application/x-tex">0" "</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">0""</span></span></span></span></span>{0%.txt}"' {} \;</p>
<h3 id="prepare-mutilple-bash-file-to-launch-on-baobab"><a aria-hidden="true" class="anchor-heading" href="#prepare-mutilple-bash-file-to-launch-on-baobab"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Prepare mutilple bash file to launch on baobab</h3>
<p>(strangely enough the .sh incrementer script return an error on Linux, runned OK on MacOS command line )</p>
<p>Note: apparently sbatch as been replaced by srun on the boabab server side. Be sure to update the scripts accordingly</p>
<h2 id="fetching-cfm-predict-results"><a aria-hidden="true" class="anchor-heading" href="#fetching-cfm-predict-results"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Fetching cfm-predict results</h2>
<p>Download cfm-predict fragmentation results from the baob server using rsync command</p>
<p>rsync -rvz -e 'ssh' --progress <a href="mailto:allardp@baobab2.unige.ch">allardp@baobab2.unige.ch</a>:/home/allardp/CFM_results/npatlas ./results
rsync -rvz -e 'ssh' --progress <a href="mailto:allardp@baobab2.unige.ch">allardp@baobab2.unige.ch</a>:/home/allardp/CFM_results/coconut/ .</p>
<p>find ./ -type f -name '*.mgf' | wc  </p>
<p>allows to count all file in a folder
Here 25090 files for NPatalas</p>
<p>Coconut 384222 .log files</p>
<p> 384150 mgf files</p>
<h2 id="we-might-eventually-need-to-move-all-files-from-subfolders-recursively-to-a-superior-folder"><a aria-hidden="true" class="anchor-heading" href="#we-might-eventually-need-to-move-all-files-from-subfolders-recursively-to-a-superior-folder"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>We might eventually need to move all files from subfolders recursively to a superior folder</h2>
<p>find ./bacasable -type f -print0 | xargs -0 mv -t ./bacasable</p>
<p>find ./results_coconut -type f -print0 | xargs -0 mv -t ./results_coconut</p>
<h2 id="pruning-the-raw-log-files"><a aria-hidden="true" class="anchor-heading" href="#pruning-the-raw-log-files"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Pruning the raw log files</h2>
<p>The output of cfm-predict consist of .log file containing mass spectra, where each fragments are individually labelled and eventually linked to a substrcture. Such information might be usefull later but for now we only want to keep the raw ms data</p>
<p>(need to define a help function here)</p>
<p>python raw_log_treater_npatlas.py ../npatlas_data/results_npatlas/npatlas/ .log
python raw_log_treater.py ../coconut_data/results_coconut/ .log</p>
<p>At this step .log file should be pruned and contains only digits (m/z and intensities)</p>
<p>for coconut Parsing directory../coconut_data/results_coconut/ with file extension :.log</p>
<p>'mass' ../coconut_data/results_coconut/CNP0402147.log
'mass' ../coconut_data/results_coconut/CNP0153817.log
'mass' ../coconut_data/results_coconut/CNP0155980.log
'mass' ../coconut_data/results_coconut/CNP0086807.log
'mass' ../coconut_data/results_coconut/CNP0199206.log
'mass' ../coconut_data/results_coconut/CNP0334817.log
'mass' ../coconut_data/results_coconut/CNP0366374.log
'mass' ../coconut_data/results_coconut/CNP0232712.log
'mass' ../coconut_data/results_coconut/CNP0370068.log
'mass' ../coconut_data/results_coconut/CNP0055178.log
'mass' ../coconut_data/results_coconut/CNP0228597.log
'mass' ../coconut_data/results_coconut/CNP0119974.log
'mass' ../coconut_data/results_coconut/CNP0132139.log
'mass' ../coconut_data/results_coconut/CNP0145457.log
'mass' ../coconut_data/results_coconut/CNP0230801.log
'mass' ../coconut_data/results_coconut/CNP0310370.log
'mass' ../coconut_data/results_coconut/CNP0149436.log
'mass' ../coconut_data/results_coconut/CNP0396848.log
'mass' ../coconut_data/results_coconut/CNP0401434.log
'mass' ../coconut_data/results_coconut/CNP0101561.log
'mass' ../coconut_data/results_coconut/CNP0390928.log
'mass' ../coconut_data/results_coconut/CNP0405256.log
'mass' ../coconut_data/results_coconut/CNP0395006.log
'mass' ../coconut_data/results_coconut/CNP0159145.log
'mass' ../coconut_data/results_coconut/CNP0131085.log
'mass' ../coconut_data/results_coconut/CNP0230696.log
'mass' ../coconut_data/results_coconut/CNP0014450.log
'mass' ../coconut_data/results_coconut/CNP0214739.log
'mass' ../coconut_data/results_coconut/CNP0302005.log
'mass' ../coconut_data/results_coconut/CNP0279314.log
'mass' ../coconut_data/results_coconut/CNP0177036.log
'mass' ../coconut_data/results_coconut/CNP0274256.log
'mass' ../coconut_data/results_coconut/CNP0403745.log
'mass' ../coconut_data/results_coconut/CNP0039287.log
'mass' ../coconut_data/results_coconut/CNP0238803.log
'mass' ../coconut_data/results_coconut/CNP0014261.log
'mass' ../coconut_data/results_coconut/CNP0077076.log
'mass' ../coconut_data/results_coconut/CNP0125300.log
'mass' ../coconut_data/results_coconut/CNP0228582.log
'mass' ../coconut_data/results_coconut/CNP0393136.log
'mass' ../coconut_data/results_coconut/CNP0338003.log
'mass' ../coconut_data/results_coconut/CNP0070182.log
'mass' ../coconut_data/results_coconut/CNP0230961.log
'mass' ../coconut_data/results_coconut/CNP0001326.log
'mass' ../coconut_data/results_coconut/CNP0088652.log
'mass' ../coconut_data/results_coconut/CNP0045797.log
'mass' ../coconut_data/results_coconut/CNP0175458.log
'mass' ../coconut_data/results_coconut/CNP0300969.log
'mass' ../coconut_data/results_coconut/CNP0030335.log
'mass' ../coconut_data/results_coconut/CNP0126194.log
'mass' ../coconut_data/results_coconut/CNP0334816.log
'mass' ../coconut_data/results_coconut/CNP0290616.log
'mass' ../coconut_data/results_coconut/CNP0386127.log
'mass' ../coconut_data/results_coconut/CNP0406328.log
'mass' ../coconut_data/results_coconut/CNP0127289.log
'mass' ../coconut_data/results_coconut/CNP0032755.log
'mass' ../coconut_data/results_coconut/CNP0258640.log
'mass' ../coconut_data/results_coconut/CNP0199475.log
'mass' ../coconut_data/results_coconut/CNP0350989.log
'mass' ../coconut_data/results_coconut/CNP0333350.log
'mass' ../coconut_data/results_coconut/CNP0213544.log
'mass' ../coconut_data/results_coconut/CNP0204567.log
'mass' ../coconut_data/results_coconut/CNP0148525.log
'mass' ../coconut_data/results_coconut/CNP0053639.log
'mass' ../coconut_data/results_coconut/CNP0118368.log
'mass' ../coconut_data/results_coconut/CNP0226584.log
'mass' ../coconut_data/results_coconut/CNP0254221.log
'mass' ../coconut_data/results_coconut/CNP0241364.log
'mass' ../coconut_data/results_coconut/CNP0348684.log
'mass' ../coconut_data/results_coconut/CNP0053255.log
'mass' ../coconut_data/results_coconut/CNP0167909.log
'mass' ../coconut_data/results_coconut/CNP0142603.log
Treated 384150 files, skipped 72</p>
<h2 id="populating-the-mgf-headers"><a aria-hidden="true" class="anchor-heading" href="#populating-the-mgf-headers"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Populating the mgf headers</h2>
<h3 id="preparation-of-the-adducted-metadata-table"><a aria-hidden="true" class="anchor-heading" href="#preparation-of-the-adducted-metadata-table"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Preparation of the adducted metadata table</h3>
<p>We need to prepare and adducted dataframe containing the protonated and deprotonated masses</p>
<p>This script recquire rdkit so we build a environment.yml file from a dedicated conda env</p>
<p>conda env export -n conda-env -f /path/to/environment.yml</p>
<p>Eventually you need to fetch the file from the internet (use wget )</p>
<p>wget <a href="https://zenodo.org/record/3547718/files/COCONUT4MetFrag.csv?download=1">https://zenodo.org/record/3547718/files/COCONUT4MetFrag.csv?download=1</a></p>
<p>Sometimes since SMILES or INchi can yield error and since there is a MF field, the emass can be calculated directly form the MF as described here
<a href="https://bioinformatics.stackexchange.com/a/9273">https://bioinformatics.stackexchange.com/a/9273</a>. Noooop actually not working since the GetMass() function yield a molecular weight and not and exact mass ....</p>
<p>Script table_adducter_script.py is adapted to cope with different delimiters ... beware and note that $ is mandatory to input the tab delim</p>
<p>python table_adducter_npatlas_script.py ../npatlas_data/np_atlas_2019_12.tsv ../npatlas_data/np_atlas_2019_12_adducted.tsv</p>
<p>python table_adducter_script.py ../coconut_data/COCONUT4MetFrag.csv ',' ../coconut_data/COCONUT4MetFrag_adducted.csv $'\t'</p>
<h3 id="addition-of-the-metadata-to-the-individual-mgf-headers"><a aria-hidden="true" class="anchor-heading" href="#addition-of-the-metadata-to-the-individual-mgf-headers"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Addition of the metadata to the individual mgf headers</h3>
<p>We can now populate each raw mgf with its corresponding metadata. For this we use the treat_npatlas.py script</p>
<p>python treat_npatlas.py ../npatlas_data/np_atlas_2019_12_adducted.tsv ../npatlas_data/results_npatlas/npatlas/</p>
<p>python mgf_header_populater.py ../coconut_data/COCONUT4MetFrag_adducted.csv ../coconut_data/results_coconut/ Identifier</p>
<p>on coconut </p>
<p>Treated 384150 files, skipped 28161.</p>
<h2 id="generating-the-final-spectral-file"><a aria-hidden="true" class="anchor-heading" href="#generating-the-final-spectral-file"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Generating the final spectral file</h2>
<p>We concatenate each documented mgf files to a single spectral mgf file.</p>
<p>find ./ -type f -name '<em>.mgf' | while read F; do cat ${F} >> ../../npatlas_ISDB_pos.mgf; done
find ./ -type f -name '</em>.mgf' | while read F; do cat ${F} >> ../../coconut_ISDB_pos.mgf; done</p>
<h2 id="outputting-non-fragmented-entries"><a aria-hidden="true" class="anchor-heading" href="#outputting-non-fragmented-entries"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Outputting non-fragmented entries</h2>
<p>For several reasons (charged compounds, some tautomers, structures too heavy to be fragmented in a reasonable amount of time) some entries might not have been fragmented. </p>
<p>To find them we will first list all correctly converted mgf</p>
<p>find ./ -type f -name '<em>.mgf' | sed 's!.</em>/!!' | sed 's!^!!' >  list_mgf.txt</p>
<p>%%here eventually without the extension</p>
<p>find ./ -type f -name '<em>.mgf' | sed 's!.</em>/!!' | sed 's!.mgf!!' >  ../../list_mgf.txt</p>
<p>And then the list is compared to the initial input using the table_comparator.py </p>
<p>python table_comparator.py ../npatlas_data/npatlas_for_frag.txt ../npatlas_data/list_mgf.txt ../npatlas_data/unfragged_list.txt</p>
<h3 id="check-molvs-for-structure-standardization"><a aria-hidden="true" class="anchor-heading" href="#check-molvs-for-structure-standardization"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>check molVS for structure standardization</h3>
<p><a href="https://molvs.readthedocs.io/en/latest/index.html">https://molvs.readthedocs.io/en/latest/index.html</a></p>
</div></div><p></p><p></p>
<p>I launched too many job on the beast so at the end memory was full and all cores saturated.
Need to find a way to handle this.
I killed everything using </p>
<p>sudo pkill cfm
sudo pkill docker</p>
<p>I will now need to list all calculated spectra</p>
<p>~/cfm/cfm_output$ ls > ../calculated_spectra.txt</p>
<p>I then fetch this back
Or rather I will set up a connection to the beast via VSCode</p>
<p>We use sed line to remove the extensions </p>
<p>sed 's|.log||g' calculated_spectra.txt</p>
<p>the -i operator allows to do it inplace</p>
<p>sed -i 's|.log||g' calculated_spectra.txt</p>
<p>I upload the full platinium to the beast
rsync -rvz -e 'ssh' --progress ./platinum.tsv.gz allardpm<a title="Private" style="color: brown" href="https://wiki.dendron.so/notes/hfyvYGJZQiUwQaaxQO27q.html" target="_blank">@biolpc045600 (Private)</a>:/home/allardpm/cfm/</p>
<p>I run the
frag_list_preparator_nb.py</p>
<p>gzip -d  sub_platinum_tofrag.tsv.gz</p>
<h5 id=""><a aria-hidden="true" class="anchor-heading" href="#"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a></h5>
<p>messing around with gnu parralel</p>
<p>parallel -a names.txt echo
<a href="https://blog.ronin.cloud/gnu-parallel/">https://blog.ronin.cloud/gnu-parallel/</a></p>
<p>mv argument list too long </p>
<p>find . -name . -o -type d -prune -o \
-name '<em>.jpg' -o -name '</em>.png' -o -name '*.bmp' -o \
-exec mv -t targetdir/ {} +</p>
<p>find Programs/cfm-id-code/cfm/bin/cfm_output/ \
-name '*.log' -o \
-exec mv -t cfm/cfm_output/ {} +</p>
<p>find ./cfm_output -name '*.log' -exec mv {} . \;</p>
<h2 id="monday-28-february-2022"><a aria-hidden="true" class="anchor-heading" href="#monday-28-february-2022"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Monday 28 February 2022</h2>
<p>Taking over
last bash files looked like </p>
<pre><code>#!/bin/sh

export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/lib:/home/allardpm/Programs/lp_solve_5.5/lpsolve55/bin/ux64
cd /home/allardpm/Programs/cfm-id-code/cfm/bin
./cfm-predict /home/allardpm/cfm/cfm_input/splitted/lotus_to_frag_00097.txt 0.001 /home/allardpm/Programs/cfm-id-code/cfm-pretrained-models/[M+H]+/param_output.log /home/allardpm/Programs/cfm-id-code/cfm-pretrained-models/[M+H]+/param_config.txt 1 cfm_output/ &#x26; >/dev/nul
</code></pre>
<p>We move every body to a subfolder</p>
<p>find ./ -name '*.log' -exec mv {} ./all_log \;</p></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#variant-of-the-is-fragmentation-recipee-on-the-beast" title="Variant of the is fragmentation recipee on the beast">Variant of the is fragmentation recipee on the beast</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#" title=""></a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#monday-28-february-2022" title="Monday 28 February 2022">Monday 28 February 2022</a></div></div></div></div></div></div></div></div></div></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></main></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"Mlb5F1TDswu1OkB4yKCXI","title":"Beast","desc":"","updated":1646061947037,"created":1634965352373,"custom":{},"fname":"tools.chemoinformatics.isfrag.beast","type":"note","vault":{"fsPath":"vault"},"contentHash":"fa4a4808a2571a5e9bdcc429e349718d","links":[{"type":"wiki","from":{"fname":"tools.chemoinformatics.isfrag.beast","id":"Mlb5F1TDswu1OkB4yKCXI","vaultName":"vault"},"value":"user.biolpc045600","alias":"@biolpc045600","position":{"start":{"line":32,"column":58,"offset":735},"end":{"line":32,"column":71,"offset":748},"indent":[]},"xvault":false,"to":{"fname":"user.biolpc045600"}},{"type":"ref","from":{"fname":"tools.chemoinformatics.isfrag.beast","id":"Mlb5F1TDswu1OkB4yKCXI","vaultName":"vault"},"value":"tools.chemoinformatics.isfrag","position":{"start":{"line":4,"column":1,"offset":57},"end":{"line":4,"column":35,"offset":91},"indent":[]},"xvault":false,"to":{"fname":"tools.chemoinformatics.isfrag"}}],"anchors":{"variant-of-the-is-fragmentation-recipee-on-the-beast":{"type":"header","text":"Variant of the is fragmentation recipee on the beast","value":"variant-of-the-is-fragmentation-recipee-on-the-beast","line":8,"column":0,"depth":1},"":{"type":"header","text":"","value":"","line":47,"column":0,"depth":5},"monday-28-february-2022":{"type":"header","text":"Monday 28 February 2022","value":"monday-28-february-2022","line":70,"column":0,"depth":2}},"children":[],"parent":"6qK8k4MF0vooncgMJZw5W","data":{}},"body":"\u003ch1 id=\"beast\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#beast\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eBeast\u003c/h1\u003e\n\u003ch1 id=\"variant-of-the-is-fragmentation-recipee-on-the-beast\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#variant-of-the-is-fragmentation-recipee-on-the-beast\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eVariant of the is fragmentation recipee on the beast\u003c/h1\u003e\n\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\u003cdiv class=\"portal-container\"\u003e\n\u003cdiv class=\"portal-head\"\u003e\n\u003cdiv class=\"portal-backlink\"\u003e\n\u003cdiv class=\"portal-title\"\u003eFrom \u003cspan class=\"portal-text-title\"\u003eIsfrag\u003c/span\u003e\u003c/div\u003e\n\u003ca href=\"/dendron-ws-public/notes/6qK8k4MF0vooncgMJZw5W\" class=\"portal-arrow\"\u003eGo to text \u003cspan class=\"right-arrow\"\u003e→\u003c/span\u003e\u003c/a\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv id=\"portal-parent-anchor\" class=\"portal-parent\" markdown=\"1\"\u003e\n\u003cdiv class=\"portal-parent-fader-top\"\u003e\u003c/div\u003e\n\u003cdiv class=\"portal-parent-fader-bottom\"\u003e\u003c/div\u003e\u003cp\u003ePasting an old recipee from ZettelKasten\u003c/p\u003e\n\u003cp\u003eLinked to \u003ca title=\"Private\" style=\"color: brown\" href=\"https://wiki.dendron.so/notes/hfyvYGJZQiUwQaaxQO27q.html\" target=\"_blank\"\u003e202002251433 (Private)\u003c/a\u003e in silico fragmentation worflow.\u003c/p\u003e\n\u003cp\u003eChildren workflow on the beast MAPP \u003c/p\u003e\n\u003cp\u003eSide notes : try to write everything as scripts so that they can be launched without a GUI (ex on X2Go or directly Boabab).\u003c/p\u003e\n\u003ch1 id=\"tutorial-for-npatlas-in-silico-fragmentation-data-treatment\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#tutorial-for-npatlas-in-silico-fragmentation-data-treatment\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eTutorial for NPatlas in silico fragmentation data treatment\u003c/h1\u003e\n\u003ch2 id=\"prior-to-fragmentation\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#prior-to-fragmentation\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003ePrior to fragmentation\u003c/h2\u003e\n\u003ch3 id=\"prepare-space-delimited-input-file\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#prepare-space-delimited-input-file\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003ePrepare space delimited input file\u003c/h3\u003e\n\u003cp\u003eComplete metadate file is converted to list of Unique ID and smiles space separated (for cfm id input)\u003c/p\u003e\n\u003cp\u003epython frag_list_preparator.py ../npatlas_data/np_atlas_2019_12.tsv ../npatlas_data/np_atlas_2019_12_for_frag.tsv NPAID SMILES\u003c/p\u003e\n\u003cp\u003epython frag_list_preparator.py ../open_np_db_data/open_NP_db.tsv ../open_np_db_data/open_NP_db_tofrag.txt shortinchikey shortinchikey smiles\u003c/p\u003e\n\u003ch3 id=\"split-the-file\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#split-the-file\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eSplit the file\u003c/h3\u003e\n\u003cp\u003e(Works on Linux based shells)\u003c/p\u003e\n\u003cp\u003esplit -a 5 -l 500 -d ../open\u003cem\u003enp_db_data/open_NP_db_tofrag.txt ../open_np_db_data/opennpdb_tofrag/opennpdb\u003c/em\u003e\nsplit -a 5 -l 500 -d ./lotus\u003cem\u003edata/lotus_data_for_frag.txt ./lotus_data/lotus_data_for_frag/lotus_data\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003esplit -a 5 -l 500 -d ./ ./lotus\u003cem\u003edata/lotus_data_for_frag/lotus_data\u003c/em\u003e\nsplit -a 5 -l 500 -d cfm/cfm\u003cem\u003einput/platinum_tofrag.tsv cfm/cfm_input/splitted/lotus_to_frag\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eThis one allows to preserve extensions and is build on number of desired chunks without splitting lines\nsplit -a 5 -n l/199 -d --additional-suffix=.txt  cfm\u003cem\u003einput/sub_platinum_tofrag.tsv cfm_input/splitted/lotus_to_frag\u003c/em\u003e\u003c/p\u003e\n\u003ch3 id=\"when-using-the-docker-cli-files-need-to-have-an-extension-or-taken-as-folder-\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#when-using-the-docker-cli-files-need-to-have-an-extension-or-taken-as-folder-\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eWhen using the docker cli files need to have an extension (or taken as folder ?)\u003c/h3\u003e\n\u003cp\u003efor f in *; do mv \"\u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ef\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003e\"\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003e\"\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ef\" \"\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\"\u003ef\u003c/span\u003e\u003cspan class=\"mord\"\u003e\"\"\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003ef.txt\"; done\u003c/p\u003e\n\u003cp\u003eif you made a mistacke \u003c/p\u003e\n\u003cp\u003efind / -type f -name '*.txt' -exec sh -c 'mv -- \"\u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmn\u003e0\u003c/mn\u003e\u003cmi mathvariant=\"normal\"\u003e\"\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003e\"\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e0\" \"\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e0\"\"\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e{0%.txt}\"' {} \\;\u003c/p\u003e\n\u003ch3 id=\"prepare-mutilple-bash-file-to-launch-on-baobab\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#prepare-mutilple-bash-file-to-launch-on-baobab\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003ePrepare mutilple bash file to launch on baobab\u003c/h3\u003e\n\u003cp\u003e(strangely enough the .sh incrementer script return an error on Linux, runned OK on MacOS command line )\u003c/p\u003e\n\u003cp\u003eNote: apparently sbatch as been replaced by srun on the boabab server side. Be sure to update the scripts accordingly\u003c/p\u003e\n\u003ch2 id=\"fetching-cfm-predict-results\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#fetching-cfm-predict-results\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eFetching cfm-predict results\u003c/h2\u003e\n\u003cp\u003eDownload cfm-predict fragmentation results from the baob server using rsync command\u003c/p\u003e\n\u003cp\u003ersync -rvz -e 'ssh' --progress \u003ca href=\"mailto:allardp@baobab2.unige.ch\"\u003eallardp@baobab2.unige.ch\u003c/a\u003e:/home/allardp/CFM_results/npatlas ./results\nrsync -rvz -e 'ssh' --progress \u003ca href=\"mailto:allardp@baobab2.unige.ch\"\u003eallardp@baobab2.unige.ch\u003c/a\u003e:/home/allardp/CFM_results/coconut/ .\u003c/p\u003e\n\u003cp\u003efind ./ -type f -name '*.mgf' | wc  \u003c/p\u003e\n\u003cp\u003eallows to count all file in a folder\nHere 25090 files for NPatalas\u003c/p\u003e\n\u003cp\u003eCoconut 384222 .log files\u003c/p\u003e\n\u003cp\u003e 384150 mgf files\u003c/p\u003e\n\u003ch2 id=\"we-might-eventually-need-to-move-all-files-from-subfolders-recursively-to-a-superior-folder\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#we-might-eventually-need-to-move-all-files-from-subfolders-recursively-to-a-superior-folder\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eWe might eventually need to move all files from subfolders recursively to a superior folder\u003c/h2\u003e\n\u003cp\u003efind ./bacasable -type f -print0 | xargs -0 mv -t ./bacasable\u003c/p\u003e\n\u003cp\u003efind ./results_coconut -type f -print0 | xargs -0 mv -t ./results_coconut\u003c/p\u003e\n\u003ch2 id=\"pruning-the-raw-log-files\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#pruning-the-raw-log-files\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003ePruning the raw log files\u003c/h2\u003e\n\u003cp\u003eThe output of cfm-predict consist of .log file containing mass spectra, where each fragments are individually labelled and eventually linked to a substrcture. Such information might be usefull later but for now we only want to keep the raw ms data\u003c/p\u003e\n\u003cp\u003e(need to define a help function here)\u003c/p\u003e\n\u003cp\u003epython raw_log_treater_npatlas.py ../npatlas_data/results_npatlas/npatlas/ .log\npython raw_log_treater.py ../coconut_data/results_coconut/ .log\u003c/p\u003e\n\u003cp\u003eAt this step .log file should be pruned and contains only digits (m/z and intensities)\u003c/p\u003e\n\u003cp\u003efor coconut Parsing directory../coconut_data/results_coconut/ with file extension :.log\u003c/p\u003e\n\u003cp\u003e'mass' ../coconut_data/results_coconut/CNP0402147.log\n'mass' ../coconut_data/results_coconut/CNP0153817.log\n'mass' ../coconut_data/results_coconut/CNP0155980.log\n'mass' ../coconut_data/results_coconut/CNP0086807.log\n'mass' ../coconut_data/results_coconut/CNP0199206.log\n'mass' ../coconut_data/results_coconut/CNP0334817.log\n'mass' ../coconut_data/results_coconut/CNP0366374.log\n'mass' ../coconut_data/results_coconut/CNP0232712.log\n'mass' ../coconut_data/results_coconut/CNP0370068.log\n'mass' ../coconut_data/results_coconut/CNP0055178.log\n'mass' ../coconut_data/results_coconut/CNP0228597.log\n'mass' ../coconut_data/results_coconut/CNP0119974.log\n'mass' ../coconut_data/results_coconut/CNP0132139.log\n'mass' ../coconut_data/results_coconut/CNP0145457.log\n'mass' ../coconut_data/results_coconut/CNP0230801.log\n'mass' ../coconut_data/results_coconut/CNP0310370.log\n'mass' ../coconut_data/results_coconut/CNP0149436.log\n'mass' ../coconut_data/results_coconut/CNP0396848.log\n'mass' ../coconut_data/results_coconut/CNP0401434.log\n'mass' ../coconut_data/results_coconut/CNP0101561.log\n'mass' ../coconut_data/results_coconut/CNP0390928.log\n'mass' ../coconut_data/results_coconut/CNP0405256.log\n'mass' ../coconut_data/results_coconut/CNP0395006.log\n'mass' ../coconut_data/results_coconut/CNP0159145.log\n'mass' ../coconut_data/results_coconut/CNP0131085.log\n'mass' ../coconut_data/results_coconut/CNP0230696.log\n'mass' ../coconut_data/results_coconut/CNP0014450.log\n'mass' ../coconut_data/results_coconut/CNP0214739.log\n'mass' ../coconut_data/results_coconut/CNP0302005.log\n'mass' ../coconut_data/results_coconut/CNP0279314.log\n'mass' ../coconut_data/results_coconut/CNP0177036.log\n'mass' ../coconut_data/results_coconut/CNP0274256.log\n'mass' ../coconut_data/results_coconut/CNP0403745.log\n'mass' ../coconut_data/results_coconut/CNP0039287.log\n'mass' ../coconut_data/results_coconut/CNP0238803.log\n'mass' ../coconut_data/results_coconut/CNP0014261.log\n'mass' ../coconut_data/results_coconut/CNP0077076.log\n'mass' ../coconut_data/results_coconut/CNP0125300.log\n'mass' ../coconut_data/results_coconut/CNP0228582.log\n'mass' ../coconut_data/results_coconut/CNP0393136.log\n'mass' ../coconut_data/results_coconut/CNP0338003.log\n'mass' ../coconut_data/results_coconut/CNP0070182.log\n'mass' ../coconut_data/results_coconut/CNP0230961.log\n'mass' ../coconut_data/results_coconut/CNP0001326.log\n'mass' ../coconut_data/results_coconut/CNP0088652.log\n'mass' ../coconut_data/results_coconut/CNP0045797.log\n'mass' ../coconut_data/results_coconut/CNP0175458.log\n'mass' ../coconut_data/results_coconut/CNP0300969.log\n'mass' ../coconut_data/results_coconut/CNP0030335.log\n'mass' ../coconut_data/results_coconut/CNP0126194.log\n'mass' ../coconut_data/results_coconut/CNP0334816.log\n'mass' ../coconut_data/results_coconut/CNP0290616.log\n'mass' ../coconut_data/results_coconut/CNP0386127.log\n'mass' ../coconut_data/results_coconut/CNP0406328.log\n'mass' ../coconut_data/results_coconut/CNP0127289.log\n'mass' ../coconut_data/results_coconut/CNP0032755.log\n'mass' ../coconut_data/results_coconut/CNP0258640.log\n'mass' ../coconut_data/results_coconut/CNP0199475.log\n'mass' ../coconut_data/results_coconut/CNP0350989.log\n'mass' ../coconut_data/results_coconut/CNP0333350.log\n'mass' ../coconut_data/results_coconut/CNP0213544.log\n'mass' ../coconut_data/results_coconut/CNP0204567.log\n'mass' ../coconut_data/results_coconut/CNP0148525.log\n'mass' ../coconut_data/results_coconut/CNP0053639.log\n'mass' ../coconut_data/results_coconut/CNP0118368.log\n'mass' ../coconut_data/results_coconut/CNP0226584.log\n'mass' ../coconut_data/results_coconut/CNP0254221.log\n'mass' ../coconut_data/results_coconut/CNP0241364.log\n'mass' ../coconut_data/results_coconut/CNP0348684.log\n'mass' ../coconut_data/results_coconut/CNP0053255.log\n'mass' ../coconut_data/results_coconut/CNP0167909.log\n'mass' ../coconut_data/results_coconut/CNP0142603.log\nTreated 384150 files, skipped 72\u003c/p\u003e\n\u003ch2 id=\"populating-the-mgf-headers\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#populating-the-mgf-headers\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003ePopulating the mgf headers\u003c/h2\u003e\n\u003ch3 id=\"preparation-of-the-adducted-metadata-table\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#preparation-of-the-adducted-metadata-table\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003ePreparation of the adducted metadata table\u003c/h3\u003e\n\u003cp\u003eWe need to prepare and adducted dataframe containing the protonated and deprotonated masses\u003c/p\u003e\n\u003cp\u003eThis script recquire rdkit so we build a environment.yml file from a dedicated conda env\u003c/p\u003e\n\u003cp\u003econda env export -n conda-env -f /path/to/environment.yml\u003c/p\u003e\n\u003cp\u003eEventually you need to fetch the file from the internet (use wget )\u003c/p\u003e\n\u003cp\u003ewget \u003ca href=\"https://zenodo.org/record/3547718/files/COCONUT4MetFrag.csv?download=1\"\u003ehttps://zenodo.org/record/3547718/files/COCONUT4MetFrag.csv?download=1\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eSometimes since SMILES or INchi can yield error and since there is a MF field, the emass can be calculated directly form the MF as described here\n\u003ca href=\"https://bioinformatics.stackexchange.com/a/9273\"\u003ehttps://bioinformatics.stackexchange.com/a/9273\u003c/a\u003e. Noooop actually not working since the GetMass() function yield a molecular weight and not and exact mass ....\u003c/p\u003e\n\u003cp\u003eScript table_adducter_script.py is adapted to cope with different delimiters ... beware and note that $ is mandatory to input the tab delim\u003c/p\u003e\n\u003cp\u003epython table_adducter_npatlas_script.py ../npatlas_data/np_atlas_2019_12.tsv ../npatlas_data/np_atlas_2019_12_adducted.tsv\u003c/p\u003e\n\u003cp\u003epython table_adducter_script.py ../coconut_data/COCONUT4MetFrag.csv ',' ../coconut_data/COCONUT4MetFrag_adducted.csv $'\\t'\u003c/p\u003e\n\u003ch3 id=\"addition-of-the-metadata-to-the-individual-mgf-headers\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#addition-of-the-metadata-to-the-individual-mgf-headers\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eAddition of the metadata to the individual mgf headers\u003c/h3\u003e\n\u003cp\u003eWe can now populate each raw mgf with its corresponding metadata. For this we use the treat_npatlas.py script\u003c/p\u003e\n\u003cp\u003epython treat_npatlas.py ../npatlas_data/np_atlas_2019_12_adducted.tsv ../npatlas_data/results_npatlas/npatlas/\u003c/p\u003e\n\u003cp\u003epython mgf_header_populater.py ../coconut_data/COCONUT4MetFrag_adducted.csv ../coconut_data/results_coconut/ Identifier\u003c/p\u003e\n\u003cp\u003eon coconut \u003c/p\u003e\n\u003cp\u003eTreated 384150 files, skipped 28161.\u003c/p\u003e\n\u003ch2 id=\"generating-the-final-spectral-file\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#generating-the-final-spectral-file\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eGenerating the final spectral file\u003c/h2\u003e\n\u003cp\u003eWe concatenate each documented mgf files to a single spectral mgf file.\u003c/p\u003e\n\u003cp\u003efind ./ -type f -name '\u003cem\u003e.mgf' | while read F; do cat ${F} \u003e\u003e ../../npatlas_ISDB_pos.mgf; done\nfind ./ -type f -name '\u003c/em\u003e.mgf' | while read F; do cat ${F} \u003e\u003e ../../coconut_ISDB_pos.mgf; done\u003c/p\u003e\n\u003ch2 id=\"outputting-non-fragmented-entries\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#outputting-non-fragmented-entries\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eOutputting non-fragmented entries\u003c/h2\u003e\n\u003cp\u003eFor several reasons (charged compounds, some tautomers, structures too heavy to be fragmented in a reasonable amount of time) some entries might not have been fragmented. \u003c/p\u003e\n\u003cp\u003eTo find them we will first list all correctly converted mgf\u003c/p\u003e\n\u003cp\u003efind ./ -type f -name '\u003cem\u003e.mgf' | sed 's!.\u003c/em\u003e/!!' | sed 's!^!!' \u003e  list_mgf.txt\u003c/p\u003e\n\u003cp\u003e%%here eventually without the extension\u003c/p\u003e\n\u003cp\u003efind ./ -type f -name '\u003cem\u003e.mgf' | sed 's!.\u003c/em\u003e/!!' | sed 's!.mgf!!' \u003e  ../../list_mgf.txt\u003c/p\u003e\n\u003cp\u003eAnd then the list is compared to the initial input using the table_comparator.py \u003c/p\u003e\n\u003cp\u003epython table_comparator.py ../npatlas_data/npatlas_for_frag.txt ../npatlas_data/list_mgf.txt ../npatlas_data/unfragged_list.txt\u003c/p\u003e\n\u003ch3 id=\"check-molvs-for-structure-standardization\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#check-molvs-for-structure-standardization\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003echeck molVS for structure standardization\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"https://molvs.readthedocs.io/en/latest/index.html\"\u003ehttps://molvs.readthedocs.io/en/latest/index.html\u003c/a\u003e\u003c/p\u003e\n\u003c/div\u003e\u003c/div\u003e\u003cp\u003e\u003c/p\u003e\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eI launched too many job on the beast so at the end memory was full and all cores saturated.\nNeed to find a way to handle this.\nI killed everything using \u003c/p\u003e\n\u003cp\u003esudo pkill cfm\nsudo pkill docker\u003c/p\u003e\n\u003cp\u003eI will now need to list all calculated spectra\u003c/p\u003e\n\u003cp\u003e~/cfm/cfm_output$ ls \u003e ../calculated_spectra.txt\u003c/p\u003e\n\u003cp\u003eI then fetch this back\nOr rather I will set up a connection to the beast via VSCode\u003c/p\u003e\n\u003cp\u003eWe use sed line to remove the extensions \u003c/p\u003e\n\u003cp\u003esed 's|.log||g' calculated_spectra.txt\u003c/p\u003e\n\u003cp\u003ethe -i operator allows to do it inplace\u003c/p\u003e\n\u003cp\u003esed -i 's|.log||g' calculated_spectra.txt\u003c/p\u003e\n\u003cp\u003eI upload the full platinium to the beast\nrsync -rvz -e 'ssh' --progress ./platinum.tsv.gz allardpm\u003ca title=\"Private\" style=\"color: brown\" href=\"https://wiki.dendron.so/notes/hfyvYGJZQiUwQaaxQO27q.html\" target=\"_blank\"\u003e@biolpc045600 (Private)\u003c/a\u003e:/home/allardpm/cfm/\u003c/p\u003e\n\u003cp\u003eI run the\nfrag_list_preparator_nb.py\u003c/p\u003e\n\u003cp\u003egzip -d  sub_platinum_tofrag.tsv.gz\u003c/p\u003e\n\u003ch5 id=\"\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003e\u003c/h5\u003e\n\u003cp\u003emessing around with gnu parralel\u003c/p\u003e\n\u003cp\u003eparallel -a names.txt echo\n\u003ca href=\"https://blog.ronin.cloud/gnu-parallel/\"\u003ehttps://blog.ronin.cloud/gnu-parallel/\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003emv argument list too long \u003c/p\u003e\n\u003cp\u003efind . -name . -o -type d -prune -o \\\n-name '\u003cem\u003e.jpg' -o -name '\u003c/em\u003e.png' -o -name '*.bmp' -o \\\n-exec mv -t targetdir/ {} +\u003c/p\u003e\n\u003cp\u003efind Programs/cfm-id-code/cfm/bin/cfm_output/ \\\n-name '*.log' -o \\\n-exec mv -t cfm/cfm_output/ {} +\u003c/p\u003e\n\u003cp\u003efind ./cfm_output -name '*.log' -exec mv {} . \\;\u003c/p\u003e\n\u003ch2 id=\"monday-28-february-2022\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#monday-28-february-2022\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eMonday 28 February 2022\u003c/h2\u003e\n\u003cp\u003eTaking over\nlast bash files looked like \u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e#!/bin/sh\n\nexport LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/lib:/home/allardpm/Programs/lp_solve_5.5/lpsolve55/bin/ux64\ncd /home/allardpm/Programs/cfm-id-code/cfm/bin\n./cfm-predict /home/allardpm/cfm/cfm_input/splitted/lotus_to_frag_00097.txt 0.001 /home/allardpm/Programs/cfm-id-code/cfm-pretrained-models/[M+H]+/param_output.log /home/allardpm/Programs/cfm-id-code/cfm-pretrained-models/[M+H]+/param_config.txt 1 cfm_output/ \u0026#x26; \u003e/dev/nul\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe move every body to a subfolder\u003c/p\u003e\n\u003cp\u003efind ./ -name '*.log' -exec mv {} ./all_log \\;\u003c/p\u003e","noteIndex":{"id":"gvOH1py1NfW3ihejtp1nt","title":"Root","desc":"","updated":1629628449617,"created":1629628449617,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"vault"},"contentHash":"35415410233b3af68001893c83fd0c46","links":[{"type":"wiki","from":{"fname":"root","id":"gvOH1py1NfW3ihejtp1nt","vaultName":"vault"},"value":"user.oolonek","alias":"@oolonek","position":{"start":{"line":5,"column":7,"offset":225},"end":{"line":5,"column":15,"offset":233},"indent":[]},"xvault":false,"to":{"fname":"user.oolonek"}}],"anchors":{"welcome-to-dendron":{"type":"header","text":"Welcome to Dendron","value":"welcome-to-dendron","line":7,"column":0,"depth":1}},"children":["kPtYPP8JzWBTzWz6JpnkS","3LmAI71UuDJHeWZiY9h96","TyTThFOL2RNC8FAIj5bZN","e4C8xkTTKKue3fz5ywgBH","u88hb42Nk8jvzQwtMfM3z","rInb8zzM4kEHelz4CeWDa","hUOQrqfgNFdSu7GD8fP2c","J9JmfJgjDT8Oz6WilFnKw","Iu50F9KOgYp0CDpwKBlx6","xZShWyRUMIXQaN30pKmCM","f1fsD9inrKMVapeKNhEhT","VhvHTRFNvIEee7odQvekB","D2j8S1AufMK6GbZTZ9BJz","HMvEFZAnQOxD77TnbVwGV","NYpAWkhSLKKkHIbDIbshA","0MSZusMXhweDvHD3Iggww","q5kFqQrTnytdWSux3nwOk","1PGMuBcw56lKG0Xu5sxIX","f4P2xBJLTHpQpJYiJh7BV","7KJGsaBJWOOHaHqElRaJq","BunyVngKi3As0C0CO5xhy","iRR8MxJPGIvfKl5pcOirA","3qcjidzC0tkyobYKlrWYc","uviazqrM9NUAMm9dWYVa7","7WpN3kiuBsunRJ17P3mGr","9j2pl0fgjc9tperwhyk7z9m","53WWGL5wGfRDGtBEJoqBd","EoQW6Rm5LYkkCxMgDVXHd","k7IyxWpd9nYqWlhZ96CAG","maJAMIUSNCqgSTXrQ7fu5","rrfMr3vOgkyJv21N8x99X"],"parent":null,"data":{},"body":"# Welcome to Dendron\n\nThis is the root of your dendron vault. If you decide to publish your entire vault, this will be your landing page. You are free to customize any part of this page except the frontmatter on top. \n\nKudos @oolonek, you did great job! \nWhen using https://oolonek.github.io/dendron-ws-private/, here is what I got:\n\n\u003cimg width=\"1676\" alt=\"Capture d’écran 2021-08-22 à 13 19 54\" src=\"https://user-images.githubusercontent.com/44283913/130353241-43ba98eb-d947-473c-be08-d924f0ef585b.png\"\u003e\n\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":4,"useFMTitle":true,"useNoteTitleForLink":true,"mermaid":true,"useKatex":true,"dev":{"enablePreviewV2":true},"site":{"copyAssets":true,"siteHierarchies":["root"],"siteRootDir":"docs","siteUrl":"https://oolonek.github.io","gh_edit_link":true,"gh_edit_link_text":"Click here to edit this page on Github !","gh_edit_repository":"https://github.com/oolonek/dendron-ws-public","gh_edit_branch":"main","gh_edit_view_mode":"edit","assetsPrefix":"/dendron-ws-public","usePrettyRefs":true,"siteLastModified":true,"title":"GrndStt's Dendron","description":"Personal knowledge space","duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"usePrettyLinks":true,"siteNotesDir":"notes","siteFaviconPath":"favicon.ico","gh_root":"docs/","writeStubs":true,"siteIndex":"root"},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":false,"leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2,"vaultSelectionModeOnCreate":"smart"}},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"randomNote":{},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"dendronVersion":"0.77.1","vaults":[{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":true,"maxPreviewsCached":10,"maxNoteLength":204800,"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"enableUserTags":true,"enableHashTags":true,"enableEditorDecorations":true,"enableFullHierarchyNoteTitle":false,"enableSmartRefs":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Dendron","description":"Personal Knowledge Space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"Mlb5F1TDswu1OkB4yKCXI"},"buildId":"RNRFVlTpvQWbOy_hMS16_","assetPrefix":"/dendron-ws-public","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>